---
title: Tips
date: 2020-12-15 11:42:25
categories:
  - 笔记
tags:
  - 基础理论
---
## k8s

###  tips
    k8s系统将一切事物都抽象为api资源，其遵循rest架构风格组织并管理这些资源及其对象，同时还支持通过标准的http方法对资源进行增删改查等管理操作
    核心群组：rest路径为/api/v1
    命名的群组：rest路径为/apis/$GROUP_NAME/$VERSION，例如/apis/apps/v1



### Note


## 开发

### python

### go




## cloud

### aws

### 华为云


## 正则

### 模式
   贪婪,非贪婪,独占模式(贪婪情况直接匹配,不回溯,匹配失败直接报错,性能提升)

   正则不保存子组 \d{1}(?:\d{3})?   性能提升

   \b 表示单词边界   \babc\b  只能是abc

   环视匹配(零宽断言)  限制左右类型

   只有元字符组在字符组内不需要转义 如果存在其它转义\d等则存在转义




## 数据库

### redis

    技术点分析:
        高性能: 线程模型 网络模型 数据结构 持久化
        高可用: 主从 哨兵
        高可扩展: 分片 负载均衡
    技术维度:
        案例  点
        缓存技术 面

    redis 原理
        hash存储 链式哈希处理哈希冲突 数据量足够大
        redis 单线程模型
            -- 盲目多线程性能不一定提升 读写共享资源会带来额外的开销
            -- 互斥锁性能不够好

        正常网络IO阻塞点   accept recv     select+epoll 机制处理
        持久化
            -- AOF
               体现数据库数据落盘性能点 快慢的平衡
               AOF重写机制 统一最新数据  一处拷贝 两份日志(主线程fork子线程  一份直接写保证恢复 另一份重写完替换第一份)
                 主线程fork：
                     子线程拷贝主线程内存虚拟映射表 获取同一份内存数据 主线程更新内存数据 新数据则新开辟内存空间 逐步数据分离
            -- RDB 内存快照
               内存拷贝
                  -- 阻塞
                  -- 非阻塞  新增数据复制管理 写入快照 (增量备份涉及到数据更新条数过多 浪费内存 配合AOF实现 AOF保存两次快照之间的数据)
                  -- CPU亲和性   fork出的子线程抢占父线程的cpu资源   如果存在cpu绑定

        主从   主->从->从 环形log 注意保证缓冲区大小避免覆盖写入(主库通过从库offset决定同步模式)
        哨兵   监控->选主(优先级,offset大小,id值)->通知 哨兵通讯--redis的发布订阅功能  INFO命令获取从库 客观下线需要哨兵主观不小于quorum 主从切换需要大于一半
        分片集群
            -- addslots 指定实例哈希槽大小
            -- ASK(分片迁移中,不更新本地缓存,重发请求获取数据) MOVED(分片已经完全迁移 会更新本地缓存)

        实例:
            -- string 耗内存(包含元数据与实际数据)
            -- 二级索引拆分数量级 加快搜索以及可以保障特殊的数据结构(底层数据结构会有优化变动) (类似git按commit id头几位)
            -- List在分页生成数据的时候会发生数据更新 按照索引查会存在重复 用sorted set 不会出现 因为按权重查询
            -- GEOHash 处理经纬度(类似扑克牌猜点)
            -- 时序相关  hash+sorted set (两份存储+额外网络传输) / RedisTimeSeries
            -- 消息队列  顺序 去重  可靠

         cpu:
            -- 物理核一二级缓存私有 三级缓存共用   cpu独立享有一二三缓存 多cpu通过总线连接
         优化:
            -- redis --intrinsic-latency  测试基准延迟 生产延迟超过两倍则可理解为性能下降
            -- iperf工具检测网络延迟/ 慢查询(latency monitor)
            -- 大量key过期 造成阻塞 可以 ACTIVE_EXPIRE_CYCLE_LOOKUPS_PER_LOOP/expired time = 时间+random秒
            -- redis 内存清理(增删 以及初始分配为2的指数)  (存在内存拷贝,cpu占用)设置运行阈值
            -- 缓冲区 处理了c-s架构输入输出的平衡   通过控制频率和缓冲区大小来确保稳定
            -- 缓存雪崩(大量回收操作) 缓存击穿(高并发查已经过期的) 缓存穿透(查没有的) 缓存污染
            -- 驱逐算法 时效性和频率外加衰减机制
            -- 基于单实例扩容pika 利用ssd存储
            -- lua脚本处理并发操作 实现原子性
            -- 分布式锁   锁时效性和客户端标识(避免误操作)  redlock 多实例投票维护
            -- 事务  multi exec discard处理原子性操作(监控机制实现 存在并发,但是先更新会产生信号取消后续更新)  AOF 日志可以去除未完成事务
            -- 主从不一致 监控节点延迟可读性+过期为绝对时间
            -- codis 整体更好 但不支持新版redis功能
            -- 6.0 客户端缓存key 有普通模式和广播模式更新本地数据 ACL 添加
            -- NVM 硬盘式内存条 可持久化数据 配合redis 性能有一定损耗



### sql优化


### mysql


## 消息中间件

### 整体
    通过客户端有序数字标记消息 服务端验证 确保消息可靠性


### rabbitmq

    堆积消息处理支持不够好,扩展和二次开发难度大 erlang语言过于偏    --开箱即用


### rocketmq

    比较全面,比rabbitmq性能高一个级别,不够流行,集成与兼容差些  --低延迟 稳定

### kafka

    kafka异步批量 针对大型结构更友好 在线实时业务的支持差些   -- 大数据



## os

### 整体
    实模式与保护模式    --应对兼容性   地址总线位数的增长
    cpu缓存与执行分支预测(循环中指令预存缓存)  c c++提供显示预测     数据连续 指令相同 最优
    内存预分配策略
    数组的随机访问  元素大小固定 可以根据下标得到地址


### linux


## 数据结构
1. 数组 链表(单向--修改需要重新遍历 双向--修改数据需要获取前节点指针地址 循环 )
2. 栈 受限的线性表 只允许一端操作 应用于特定的场景 后进先出

### 线性表

1. 数组是连续内存空间(cpu访问方便 范围查询更快) 随机访问(下标访问)更方便 调整性能差   链表不需要连续空间 需要遍历访问 动态调整强(栈 队列 b+树 二叉树 等 两者变化和结合)
2. 二叉树 是链表与二分法的合并 检索上有提升  平衡二叉树是为了处理退化为链表的二叉树(无左节点)
3. 跳表 链表添加多指针(每隔2^n 个节点添加指针  --二分法)  需要在检索性能和调整数据上做平衡     --redis
4  hash表 字符串对应特定下标的数组 重复数据 依赖数据量采用红黑树或者链表  缺点(空间和范围查询) //  开放寻址法(冲突则线性探查(往后寻找空闲地址插入 --优化步长平衡空节点位置) 不能删除元素)
5  bitmap 处理状态类节省空间(无需存储信息)  与(and)运算判断值  通过多个哈希函数可以减少数组长度和冲突(布隆过滤器  缺点:删除和错误率)  [ 哈希函数最优个数 数组长度/对象个数*ln(2)]
6  倒排索引(属性反查内容)   利用id匹配求交集处理联合查询
7  B+ tree给出了索引存磁盘的高效方案 摆脱内存限制(树结构与数据分开存,高效率读取磁盘块)  双向链表->范围查询   (alert table engine=innodb 重建表)
8  LSM树(NoSQL 大量写入) 批量写入代替随机写入 内存+磁盘+WAL(预写日志防断电) 存在一个实时性的问题 需要添加删除标志处理数据不一致性


### openresty
1. NYI避免热代码使用  使用openresty的api 底层有优化(存在代码预编译) --jit.dump 检测代码质量


    
